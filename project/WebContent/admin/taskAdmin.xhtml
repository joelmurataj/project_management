<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:head>
	<title>MenxhimTaske</title>
</h:head>
<h:body>
	<h:form id="form1">

		<p:growl id="growl" sticky="true" />


		<h:panelGrid columns="1" cellpadding="5">
			<p:commandButton value="Add task" type="button"
				onclick="PF('dlg1').show();" />

		</h:panelGrid>

		<p:dialog header="Add task" widgetVar="dlg1" minHeight="40">
		Tema:
			<p:inputText value="#{taskBean.taskDto.tema}" label="tema"
				required="true" id="tema">
			</p:inputText>

			<p:message for="tema" />
			Project:
			<p:selectOneMenu id="project" value="#{taskBean.taskDto.projectId}"
				style="width:150px" required="true">
				<p:ajax
					listener="#{taskBean.onProjectChange(taskBean.taskDto.projectId)}"
					update="start" />
				<f:selectItem itemLabel="Select Project" itemValue=""
					noSelectionOption="true" />
				<f:selectItems value="#{projectBean.projectDtoList}"
					var="projectDto" itemValue="#{projectDto.id}"
					itemLabel="#{projectDto.tema}" />
			</p:selectOneMenu>
			<p:message for="project" />
		Data e fillimit:
		 <p:calendar id="start" value="#{taskBean.taskDto.start}"
				mindate="#{taskBean.now}" maxdate="#{taskBean.finishDate}"
				required="true" />
			<p:message for="start" />
		Kohezgjatja e punes ne dite:
			<p:inputNumber id="ditet" value="#{taskBean.taskDto.daysOfWork}"
				required="true">
				<f:validateLongRange minimum="1" />
			</p:inputNumber>
			<p:message for="ditet" />
			
			Employee:
			<p:selectOneMenu id="employee" value="#{taskBean.taskDto.employeeId}"
				style="width:150px" required="true">
				<f:selectItem itemLabel="Select Employee" itemValue=""
					noSelectionOption="true" />
				<f:selectItems value="#{userCrudBean.userDtoList}" var="employeeDto"
					itemValue="#{employeeDto.id}" itemLabel="#{employeeDto.username}" />
			</p:selectOneMenu>
			<p:message for="employee" />
			<p:commandButton type="submit"
				update=":employeesForm:tableStateDT growl" value="Add task"
				action="#{taskBean.addTask()}"
				oncomplete="if (args &amp;&amp; !args.validationFailed) PF('dlg1').hide()"></p:commandButton>
		</p:dialog>
	</h:form>
	<h:form id="logout">
		<p:commandButton type="submit" value="Log out"
			action="#{loginBean.logOut()}"></p:commandButton>
	</h:form>
	<h:form id="employeesForm">

		<p:inputText id="globalFilter" style="width:150px"
			placeholder="Enter keyword" value="#{taskBean.employeeName}">

		</p:inputText>
		<p:selectOneMenu id="project" value="#{taskBean.projectTema}"
			style="width:150px">

			<f:selectItem itemLabel="Select Project" itemValue=""
				noSelectionOption="true" />
			<f:selectItems value="#{projectBean.projectDtoList}" var="project"
				itemValue="#{project.tema}" itemLabel="#{project.tema}" />

		</p:selectOneMenu>
		<p:commandButton type="submit" value="Search"
			action="#{taskBean.filterByName()}" update="tableStateDT"></p:commandButton>

		<p:dataTable id="tableStateDT" var="taskDto"
			value="#{taskBean.taskDtoList}" widgetVar="usersTable"
			multiViewState="true" rows="10" paginator="true"
			paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
			rowsPerPageTemplate="5,10,15" selectionMode="single"
			selection="#{taskBean.selectedTask}" rowKey="#{taskDto.id}"
			emptyMessage="No task found with given criteria">

			<p:ajax event="rowSelect" update=":employeesForm:userDetail"
				oncomplete="PF('userDialog').show()" />

			<p:column headerText="Tema">

				<h:outputText value="#{taskDto.tema}" />
			</p:column>

			<p:column headerText="Data e fillimit">
				<h:outputText value="#{taskDto.start}" />
			</p:column>

			<p:column headerText="Ditet e punes:">

				<h:outputText value="#{taskDto.daysOfWork}" />
			</p:column>

			<p:column headerText="Project:" filterBy="#{taskDto.projectId}">
				<f:facet name="filter">
					<p:selectOneMenu id="project" value="#{taskBean.projectId}"
						style="width:150px" onchange="#{taskBean.refresh()}"
						update="tableStateDT">
						<p:ajax listener="#{taskBean.refresh()}" update="tableStateDT" />
						<f:selectItem itemLabel="Select Project" itemValue=""
							noSelectionOption="true" />
						<f:selectItems value="#{projectBean.projectDtoList}" var="project"
							itemValue="#{project.id}" itemLabel="#{project.tema}" />

					</p:selectOneMenu>
				</f:facet>
				<h:outputText value="#{taskDto.projectName}" />
			</p:column>
			<p:column headerText="Employee:" >
				<h:outputText id="taskEmployee" value="#{taskDto.usernameEmployee}" />
			</p:column>
			<p:column headerText="Status:" >
				<h:outputText id="status" value="#{taskDto.statusName}" />
			</p:column>
			<p:column headerText="Fshi">

				<p:commandButton value="Delete" style="color:red"
					action="#{taskBean.deleteTask(taskDto.id)}"
					update=":employeesForm:tableStateDT :form1:growl">

					<p:confirm header="konfirmim" message="Are you sure ?"
						icon="ui-icon-alert" />
				</p:commandButton>
				<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">

					<p:commandButton value="Yes" type="button"
						styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
					<p:commandButton value="No" type="button"
						styleClass="ui-confirmdialog-no" icon="ui-icon-close" />

				</p:confirmDialog>

			</p:column>
			<p:column headerText="Edit">

				<p:commandButton id="edit" value="Edit"
					action="#{taskBean.saveTaskForEdit(taskDto.id)}"
					update=":editForm:dlg2" oncomplete="PF('dlg2').show();"
					type="submit" />
			</p:column>

		</p:dataTable>

		<p:dialog header="Task Info" widgetVar="userDialog" modal="true"
			showEffect="fade" hideEffect="fade" resizable="false">
			<p:outputPanel id="userDetail" style="text-align:center;">
				<p:panelGrid columns="2"
					rendered="#{not empty taskBean.selectedTask}"
					columnClasses="label,value">

					<h:outputText value="Tema:" />
					<h:outputText value="#{taskBean.selectedTask.tema}" />

					<h:outputText value="Data e fillimit:" />
					<h:outputText value="#{taskBean.selectedTask.start}" />

					<h:outputText value="Ditet e punes" />
					<h:outputText value="#{taskBean.selectedTask.daysOfWork}" />

				</p:panelGrid>
			</p:outputPanel>
		</p:dialog>
	</h:form>
	<h:form id="editForm">
		<p:dialog header="Edit task" widgetVar="dlg2" minHeight="40" id="dlge">
			<p:outputPanel id="dlg2">
				<h:inputHidden class="modalId" id="taskId"
					value="#{taskBean.taskDto.id}" />
		Tema:
			<p:inputText value="#{taskBean.taskDto.tema}" label="tema"
					required="true" id="tema">
				</p:inputText>

				<p:message for="tema" />
				Project:
			<p:selectOneMenu id="project" value="#{taskBean.taskDto.projectId}"
					style="width:150px" required="true">
					<p:ajax
						listener="#{taskBean.onProjectChange(taskBean.taskDto.projectId)}"
						update="start" />
					<f:selectItem itemLabel="Select Project" itemValue=""
						noSelectionOption="true" />
					<f:selectItems value="#{projectBean.projectDtoList}"
						var="projectDto" itemValue="#{projectDto.id}"
						itemLabel="#{projectDto.tema}" />
				</p:selectOneMenu>
				<p:message for="project" />
		Data e fillimit:
		 <p:calendar id="start" value="#{taskBean.taskDto.start}"
					mindate="#{taskBean.now}" maxdate="#{taskBean.finishDate}"
					required="true" />
				<p:message for="start" />
		Kohezgjatja e pujnes ne dite:
			<p:inputNumber id="ditet" value="#{taskBean.taskDto.daysOfWork}"
					required="true" />
				<p:message for="ditet" />
				Employee:
			<p:selectOneMenu id="employee" value="#{taskBean.taskDto.employeeId}"
					style="width:150px" required="true">
					<f:selectItem itemLabel="Select Employee" itemValue=""
						noSelectionOption="true" />
					<f:selectItems value="#{userCrudBean.userDtoList}"
						var="employeeDto" itemValue="#{employeeDto.id}"
						itemLabel="#{employeeDto.username}" />
				</p:selectOneMenu>
			</p:outputPanel>
			<p:commandButton type="submit"
				update=":employeesForm:tableStateDT :form1:growl" value="Edit task"
				action="#{taskBean.editTask()}"
				oncomplete="if (args &amp;&amp; !args.validationFailed) PF('dlg2').hide()"></p:commandButton>

		</p:dialog>
	</h:form>

</h:body>
</html>
